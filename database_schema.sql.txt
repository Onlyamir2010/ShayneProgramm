-- 1. Factory Resources (Fixed Machines)
create table work_lines (
  id bigint generated by default as identity primary key,
  name text not null, -- "Apollo Saw", "Wall Line 1"
  standard_capacity int not null, -- Global default (e.g., 250)
  unit_of_measure text not null -- "LF", "BF", "SF", "Station"
);

-- 2. Factory Calendar (Holidays & Weekends)
create table factory_holidays (
  id bigint generated by default as identity primary key,
  date date not null unique,
  description text -- e.g., "Christmas", "Summer Shutdown"
);

-- 3. Capacity Overrides (For Summer/Overtime)
create table capacity_overrides (
  id bigint generated by default as identity primary key,
  work_line_id bigint references work_lines(id),
  date date not null,
  new_capacity int not null -- e.g., 500 (Overtime) or 0 (Maintenance)
);

-- 4. Projects (The Mother Object)
create table projects (
  id bigint generated by default as identity primary key,
  name text not null,
  is_modular boolean default false, -- True = Modular, False = Structural
  completion_date date, -- The Target Date for Backward Scheduling
  status text default 'Active', -- Active, Completed, On Hold
  created_at timestamp with time zone default now()
);

-- 5. Project Tasks (The Scheduling Engine for Structural)
-- Holds Volume, Rate, and Dependencies for EACH line on EACH project.
create table project_tasks (
  id bigint generated by default as identity primary key,
  project_id bigint references projects(id) on delete cascade,
  work_line_id bigint references work_lines(id),
  
  -- Scheduling Inputs
  total_volume int default 0, -- Manual for Structural. Sum of Units for Modular.
  planned_rate int, -- Custom speed for this project (overrides standard).
  
  -- Dependency Logic (Microsoft Project Style)
  -- e.g., "ApolloFS+2" or just "2" (ID of predecessor)
  dependency_string text, 
  
  -- Calculated Dates (Python will fill these in)
  start_date date,
  end_date date
);

-- 6. Floors (Modular Grouping)
create table floors (
  id bigint generated by default as identity primary key,
  project_id bigint references projects(id) on delete cascade,
  name text not null, -- "Floor 1"
  estimation_date date,
  truss_design_date date,
  wall_design_date date,
  procurement_date date
);

-- 7. Units (Modular Details)
create table units (
  id bigint generated by default as identity primary key,
  project_id bigint references projects(id) on delete cascade,
  floor_id bigint references floors(id),
  name text not null, -- "301A"
  priority int, -- 1 to 80
  
  -- Volumes for this specific unit
  wall_vol_lf int default 0,
  apollo_vol_lf int default 0,
  turbo_vol_bf int default 0,
  gow_vol_bf int default 0,
  mini8_vol_bf int default 0,
  floor_cassette_vol_sf int default 0,
  ceiling_cassette_vol_sf int default 0,
  
  -- Modular Hall Info
  stations_count int default 28, -- Always 28
  current_station int default 0 -- For tracking (0 = Not started)
);

-- 8. Production Logs (The Daily Progress)
create table production_logs (
  id bigint generated by default as identity primary key,
  date date not null,
  project_id bigint references projects(id),
  work_line_id bigint references work_lines(id),
  unit_id bigint references units(id), -- Optional (Used if tracking specific unit)
  
  volume_completed int default 0, -- e.g., 200 LF
  notes text
);

-- 9. Insert Default Lines (This pre-fills your dropdown menus)
insert into work_lines (name, standard_capacity, unit_of_measure) values
('Apollo Saw', 1130, 'LF'),
('Wall Line 1', 376, 'LF'),
('Wall Line 2', 400, 'LF'),
('Turbo Saw', 3300, 'BF'),
('GOW Table', 2600, 'BF'),
('Mini 8 Table', 1500, 'BF'),
('Floor Line', 1500, 'SF'),
('Ceiling Line', 1500, 'SF'),
('Modular Hall', 1, 'Station');