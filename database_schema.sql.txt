-- 1. Factory Resources (Fixed Info)
create table work_lines (
  id bigint generated by default as identity primary key,
  name text not null, -- "Apollo Saw", "Wall Line 1"
  standard_capacity int default 0, -- Default Daily Capacity
  unit_of_measure text -- "LF", "BF"
);

-- 2. Calendar / Holidays (Ranges)
create table factory_calendar (
  id bigint generated by default as identity primary key,
  start_date date not null,
  end_date date not null, -- Can be same as start_date for 1 day
  description text, -- "Christmas Break"
  is_working_day boolean default false -- False = Holiday
);

-- 3. Capacity Overrides (Ranges)
-- "From Dec 1 to Feb 1, Wall Line 1 is 1000 LF"
create table capacity_overrides (
  id bigint generated by default as identity primary key,
  work_line_id bigint references work_lines(id),
  start_date date not null,
  end_date date not null,
  new_capacity int not null
);

-- 4. Projects (The Mother)
create table projects (
  id bigint generated by default as identity primary key,
  name text not null,
  is_modular boolean default false,
  
  -- Project Specifics
  priority int default 0, -- Higher number = Higher priority in scheduling
  num_modules int default 0, -- 0 for Structural
  
  -- SPEEDS (Project Specific Paces)
  -- If null, we use the standard machine capacity.
  pace_apollo int,
  pace_wall1 int,
  pace_wall2 int,
  pace_turbo int,
  pace_gow int,
  pace_mini8 int,
  pace_floor_line int,
  pace_ceiling_line int,
  pace_modular_hall float, -- e.g., 1.5 mods/day
  
  -- FLOOR DATES (The Smart JSON Column)
  -- Stores data like: {"Floor 1": {"design": "2025-01-01", "procurement": "2025-02-01"}}
  floor_milestones jsonb default '{}'::jsonb,
  
  completion_date date,
  status text default 'Active',
  created_at timestamp with time zone default now()
);

-- 5. Project Items (The MERGED Table)
-- This holds BOTH "Structural Batches" and "Modular Units"
create table project_items (
  id bigint generated by default as identity primary key,
  project_id bigint references projects(id) on delete cascade,
  
  -- Identity
  name text not null, -- "301A" or "Main Structure"
  floor_number int, -- Null for structural. 1, 2, 3 for Modular.
  priority int default 0, -- Sequence for Modular Hall
  
  -- VOLUMES (The Work)
  vol_apollo int default 0,
  vol_wall1 int default 0,
  vol_wall2 int default 0,
  vol_turbo int default 0,
  vol_gow int default 0,
  vol_mini8 int default 0,
  vol_floor_cassette int default 0,
  vol_ceiling_cassette int default 0,
  
  -- PREDECESSORS (The Logic)
  -- Type your "1FS+2" strings here
  pred_apollo text,
  pred_wall1 text,
  pred_wall2 text,
  pred_turbo text,
  pred_gow text,
  pred_mini8 text,
  pred_floor_cassette text,
  pred_ceiling_cassette text
);

-- 6. Production Logs (Wide Format)
-- One row per day, per item.
create table production_logs (
  id bigint generated by default as identity primary key,
  date date not null,
  project_id bigint references projects(id),
  project_item_id bigint references project_items(id), -- Link to 301A or Structural Job
  
  -- Daily Progress (Fill what you did today)
  done_apollo int default 0,
  done_wall1 int default 0,
  done_wall2 int default 0,
  done_turbo int default 0,
  done_gow int default 0,
  done_mini8 int default 0,
  done_floor_cassette int default 0,
  done_ceiling_cassette int default 0,
  
  -- Location Tracking
  current_station int, -- 1-28 (Only for Modular)
  
  notes text
);

-- 7. Insert Default Machines
insert into work_lines (name, standard_capacity, unit_of_measure) values
('Apollo Saw', 1130, 'LF'),
('Wall Line 1', 376, 'LF'),
('Wall Line 2', 400, 'LF'),
('Turbo Saw', 3300, 'BF'),
('GOW Table', 2600, 'BF'),
('Mini 8 Table', 1500, 'BF'),
('Floor Line', 1500, 'SF'),
('Ceiling Line', 1500, 'SF'),
('Modular Hall', 1, 'Station');
